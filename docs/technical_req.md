# 1. Цель проекта

Цель проекта — разработать систему регистрации посещений тренировок по абонементу (далее Система). Администратор/Тренер может создавать в Системе разные абонементы, управлять их стоимостью, отмечать посещенные тренировки, изменять даты тренировок, удалять Клиентов. В Системе также должна быть интеграция с Telegram чатом, в котором будет работать бот, уведомляющий Клиента о наступлении платежных обязательств и другой важной информации.  


# 2. Описание системы

Система состоит из следующих основных функциональных блоков:

1. Регистрация, аутентификация и авторизация
2. Функционал для администратора/тренера
3. Функционал оплаты абонементов или разового платежа и главной страницы
4. Функционал для клиента
5. Функционал интеграции с Telegram
6. Уведомления об оплате, окончании абонемента, переноса тренировок.


## 2.1. Типы клиентов

Система предусматривает следующие типы пользователей системы: администратор/тренер, клиент, гость.
Администратор или Тренер создаёт абонементы, ведет учет тренировок, редактирует расписание. Клиент получает доступ к телеграмм каналу, списку доступных тренировок, в соответсвии с условиями абонемента.


## 2.2. Регистрация 

Системы привязана к одному конкретному залу. При этом за счёт открытого исходного кода
Систему может скачать и развернуть любой желающий.

На будущее - ведение разных залов/тренеров в рамках одной инсталляции

Процесс заведения тренера в инсталляции Системы может быть реализован
в первой версии не в интерфейсе Системы, а при помощи команды на сервере,
это допускается. Этой команде заведения автора должны быть переданы на вход
следующие данные:

* email/номер телефона — обязательное поле
* пароль — обязательное поле

Процесс заведения тренера через команду на сервере должен быть описан в
документации Системы.

Процесс регистрации клиентов, конечно, должен быть реализован в
интерфейсах Системы. При регистрации клиента должны быть запрошены
следующие поля:

* email — обязательное поле
* имя и фамилия — обязательное поле
* телефон — обязательное поле

После отправки формы регистрации клиента ему на email приходит
письмо с первым кодом, по которому он может войти. Аутентификация будет
происходить по разовым кодам, приходящим на email.


## 2.3. Аутентификация тренера и клиентов

Аутентификация тренера и клиентов осуществляется по email и одноразовому
паролю (или по одноразовой ссылке), который приходит на этот email (как
реализовано при входе в Skype у Microsoft).


## 2.4. Функционал для тренера/администратора

Тренер после аутентификации (ввода логина и пароля) получает доступ к 
своему автороскому функционалу в Системе. Этот функционал состоит из
следующих блоков:

1. Редактирование данных профиля
2. Заведение и редактирование типов абонементов
3. Заведение и редактирование календаря занятости
4. Отслеживание и отмечание пройденных тренировок
5. Получение уведомлений о записи на индивидульные тренировки
6. Подтверждение, редактирование, удаление записи на индивидуальные тренировки
7. Аналитика
** заложить на будущее заведение целей Клиента, отслеживание прогресса, продумать метрики (вес, силовые, опыт(?)).


### 2.4.1. Редактирование профиля

В этом разделе у тренера есть возможность редактирования данных
своего профиля — email, телефон, название и описание тренировки, соц сети.
Возможные соц сети:

* Yandex.Zen
* YouTube
* Instagram
* Facebook
* VK
* Linkedin

Должна быть возможность сменить пароль, подтвердив свой старый пароль.

Если дизайн Системы будет подразумевать какие-то изображения для кастомизации
страницы Системы, то эти изображения тоже должны редактироваться из профиля
тренера.


### 2.4.2. Заведение и редактирование типов подписки

По каждому типу абонемента задаются:

* название абонемента
* описание абонемента
* срок действия
* стоимость в рублях
** возможность единожды постеить пробную тренировку
* доступ в Telegram канал

Должна быть возможность (опциональная) задать скидки за покупку
абонемента на 3, 6 и 12 месяцев. Скидка задаётся в рублях за это
покупаемое количество месяцев.


### 2.4.3. Заведение и редактирование абонемента

Абонемент делится на два вида: для индивидуальных тренировок и групповых тренировок. Для индивидуальных тренировок абонемент представляет собой счетчик доступных тренровок, срок действия, список дат и времени начала тренировок, ФИО тренера и тип тренировок. Групповые тренировки представлены в виде списка с указанием счетчика доступных тренровок, сроком действия, даты, времени начала и окончания, ФИО тренера и типом тренировки. Из списка должна быть возможность перейти на вид Календарь. В календаре цветовой индикацией выделены посещенные тренировки, доступные тренировки, пропущенные.

Должна быть возможность добавления списков и изображений в контент описания абонемента, а также возможность прикрепления файлов.

У каждого абонемента должен быть заголовок, цена, срок действия.

Должна быть возможность создать тизер абонемента — обложку и текст описания
о том, что входит в абонемент, отдельно задать возможность единовременного посещения — пробной тренировки. Этот тизер и возможность посещения пробной тренировки будет виден гостям (не прошедшим аутентификацию пользователям Системы).

Гостю должно быть видно какие тренировки он может посетить по купленному абонементу, стоимость абонемента.

Также есть возможность Гостю приобрести единичную пробную тренировку, если такое доступно в абонементе.

В само описание может вставляться: текст с форматированием (заголовки,
жирный, курсивный, перечеркнутый текст), изображения (загружаются с компьютера),
видео с YouTube (показываются в стандартном встроенном YouTube плеере). 



### 2.4.4. Заведение и редактирование целей

Тренер может заводить цели Клиента, которые отображаются в профиле клиента. Как метрики возможно использвоать вес, силовые показатели, иные показатели, заведенные тренером (выполнение определенных упражненеий на время/количество). Прогресс отображается в виде графиков по оси X – время и количество тренировок, по оси Y — выранная метрика. 


### 2.4.5. Рассылки

Тренер/Администратор может осуществлять email/Telegram рассылки из Системы. Задаётся текст письма, редактор аналогичен тому, что используется при создании постов, выбирается,
кому отправить письмо/мообщение — всем или конкретному пользователю. 

### 2.4.6. Аналитика

Тренер или Администратор видит следующую аналитику:

1. Абсолютное и относительное количество Клиентов с разным типом Абонементов. Возможно, в виде диаграмы pie-chart.

2. Платежи — списком, плюс экспорт в Excel всех платежей. Колонки:
дата-время платежа, сумма платежа, период (для абонементов на групповые тренировки и индивидуальные, а не разовых платежей), подписчик — id (это длинный хеш из 32 символов,
можно показывать по наведению мыши), имя, email.


## 2.5. Функционал оплаты абонемента или разового платежа и главной страницы

На главной странице отдельно отображаются приобретенные абонементы и не активные. Сверху отображаются активные абонементы, снизу, в отдельном блоке — не активные. По клику на активный абонемент открывается календарь на текущий месяц с отображением будущих тренировок, для индивидульных тренировок отображаются свободные даты и время для записи, проведенные тренировки. Блоки можно сворачивать. Неактивные абонементы можно удалять из списка или снова активировать. Кнопка удаления приводит к выводу окна подтверждения удаления, Кнопка активировать проводит к окну опалты.

В верхней части приложения находится логотип зала, и краткая информация — телефон, email, время работы. По клику на телефон должен открываться стандартный функционал телефона, если такое возможно. По клику по иконке зала должно открываться полная карточка зала.

Карточка зала включает в себя — вся контактная информация (телефоны, email, ссылка на соц.сети, ссылка на сайт), ФИО контактного лица или лиц, адрес, карта и как метка входа. В начальной версии хватит картинки с  yandex карты, google-карты с меткой. 

Если смотрит Гость, то он видит только тизеры абонементов с названием каждого абонемента, описанием его и ценой. Рядом с каждым типом абонемента — кнопка Подписаться, ведущая на интерфейс входа или регистрации Клиента и последующей оплаты.

При оплате Абонемента должна быть возможность оплатить сразу за
3, 6 или 12 месяцев (тренер может настроить скидки на такие платежи).

Количество Клиентов должно показываться общим числом (и индивидуальные и групповые) где-то на той же главной странице Системы.

У каждого абонемента возможно выгружать в таблицу (дата, название абонемента, его ID в  UUID, посещенные тренировки с датой и временем посещения)


### 2.5.1. Рекуррентные платежи

Рекуррентные платежи (для месячных абонементов) должны списываться через 30 дней после предыдущей оплаты. Если снять платёж не удалось — в течение ближайших 5 дней должна осуществляться ежедневная попытка списать сумму. В течение этих 5 дней доступ сохраняется, а Клиент получает после каждой неуспешной попытки письмо на email/личным сообщением в Телеграмм. После успешного снятия суммы за абонемент Клиент также получает письмо на email.

После 5 дней неуспешных попыток списать сумму абонемент становится не активным.

Шаблоны писем/сообщений не редактируется в интерфейсах Системы, жёстко зашиты в
самой системе и их можно отредактировать только изменяя эти шаблоны в коде
Системы.


## 2.6. Функционал для Клиента

Клиент может просматривать Активные и доступные абонементы. Просматривать свои цели и прогресс. 

Клиент может добавлять заявку на индивидуальную тренировку, путем указания (бронирования), даты и времени из свободных в Календаре. В Календаре забронированные даты и время отмечены желтым. Далее оповещение о бронировании получает Тренер **в будущем в виде push. На первом этапе хватит и оповезения по email**  и либо соглашается, либо меняет время/дату, либо отказывается. Если тренер подтвердил время, то дата и время окрашевается в зеленый, для остальных Клиентов отображается, как серый.

Каждый абонемент можно заморозить на определенное время (по-умолчанию 2 недели). 
 
Также у Клиентов должна быть возможность на странице своего профиля
отредактировать его данные (email, телефон, сменить пароль) и запросить отмену абонемента, что приведёт к остановке рекуррентных ежемесячных платежей и после
даты окончания оплаченного периода абонемента. 

В профиле должна быть возможность отключить email сообщения от Системы.


## 2.7. Функционал интеграции с Telegram

Система должна управлять Клиентами в одном конкретном чате. Если оплаченных абонементов нет, то Клиент становится Гостем(?) и теряет доступ к Telegram каналу.


## 2.8. Уведомления

Автоматически подписчикам должны приходить уведомления на Email о всех изменениях в условиях, стоимости, сроках действия Абониментов. О подтверждении, изменении или отмене тренировки. Об акциях.


# 3. Предлагаемый стек технологий

Для реализации системы предлагается следующий стек технологий:

* Бэкенд:
    - Язык Python (Kotlin/Java)
    - Фреймворк FastAPI (Spring)
    - БД PostgreSQL
    - SQLAlchemy ORM (Apache Empire-Db)
    - Alembic для миграций (Liquibase)
    - Aiogram для интеграции с Telegram (TelegramBots /TelegramBotAPI )
* Фронтенд:
    - React
    - TypeScript

Для интернет-эквайринга рассматриваются Тинькофф и CloudPayments,
в ходе проекта надо сравнить технические возможности платформ и комиссии
за платежи. Важно иметь возможность оплаты с Google Pay, Apple Pay, МИР, крипта(btc, liteCoin, Ethernium) и UnionPay в том числе рекуррентные платежи (если Google Pay, Apple Pay, МИР и UnionPay позволяют такое делать, уточнить в ходе проекта). Важно открыть в эквайринге другие страны 
для возможности приёма оплаты не только из РФ, но и из стран СНГ и других
стран. Обсудить это в ходе проекта с эквайрингом.

Хранение файлов и изображений, загружаемых автором, должно осуществляться
в S3-совместимом хранилище.


# 4. Требования к дизайну

Минимализм, лаконичность, акцент на контент. Белый фон (переключение на черную тему). Должен присутствовать логотип Системы где-то на странице. Логотип надо разработать в рамках этого проекта.

В нижней части страницы (в подвале) должно быть написано:

Прорабоать дизайн страниц как для web, так и для мобильных устройств на будущее. 

«Работает на Open Source» со ссылкой на GitHub проекта.
